<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>fix: missing commits from upstream - SE-Extended - SE Extended is a fork from the original SnapEnhance app offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SE-Extended Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SE-Extended Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SE-Extended</strong><span class="desc"> - SE Extended is a fork from the original SnapEnhance app offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/.gitmodules.html">Submodules</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/034e94b6cffdd68634dfaca69d9c8e40e5c442c4.html">034e94b6cffdd68634dfaca69d9c8e40e5c442c4</a>
<b>parent</b> <a href="../commit/792a4a8e33ad0a41eda7e878307b80a457510dcf.html">792a4a8e33ad0a41eda7e878307b80a457510dcf</a>
<b>Author:</b> Jacob Thomas &lt;<a href="mailto:41988041+bocajthomas@users.noreply.github.com">41988041+bocajthomas@users.noreply.github.com</a>&gt;
<b>Date:</b>   Sat, 20 Jul 2024 20:50:25 +0100

fix: missing commits from upstream

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">app/src/main/kotlin/me/rhunk/snapenhance/scripting/RemoteScriptManager.kt</a></td><td> | </td><td class="num">24</td><td><span class="i">++++++++++++++</span><span class="d">----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/ActivityLauncherHelper.kt</a></td><td> | </td><td class="num">1</td><td><span class="i"></span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">common/src/main/kotlin/me/rhunk/snapenhance/common/config/ModConfig.kt</a></td><td> | </td><td class="num">46</td><td><span class="i">++++++++++++++++++++++++++</span><span class="d">--------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/Experimental.kt</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/UserInterfaceTweaks.kt</a></td><td> | </td><td class="num">3</td><td><span class="i">++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/type/ModuleInfo.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">core/src/main/kotlin/me/rhunk/snapenhance/core/SnapEnhance.kt</a></td><td> | </td><td class="num">7</td><td><span class="i">++++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">core/src/main/kotlin/me/rhunk/snapenhance/core/XposedLoader.kt</a></td><td> | </td><td class="num">12</td><td><span class="i">+++++++++++</span><span class="d">-</span></td></tr>
</table></pre><pre>8 files changed, 60 insertions(+), 36 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/scripting/RemoteScriptManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/scripting/RemoteScriptManager.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/scripting/RemoteScriptManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/scripting/RemoteScriptManager.kt</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -86,7 +86,7 @@ class RemoteScriptManager(
</a>         }
 
         sync()
<a href="#h0-0-3" id="h0-0-3" class="d">-        enabledScripts.forEach { name -&gt;
</a><a href="#h0-0-4" id="h0-0-4" class="i">+        getEnabledScripts(listOf(BindingSide.MANAGER.key)).forEach { name -&gt;
</a>             runCatching {
                 loadScript(name)
             }.onFailure {
<a href="#h0-1" id="h0-1" class="h">@@ -149,7 +149,7 @@ class RemoteScriptManager(
</a> 
             val scriptPath = filepath ?: (moduleInfo.name + &quot;.js&quot;)
             val scriptFile = getScriptsFolder()?.findFile(scriptPath) ?: getScriptsFolder()?.createFile(&quot;text/javascript&quot;, scriptPath)
<a href="#h0-1-3" id="h0-1-3" class="d">-                ?: throw Exception(&quot;Failed to create script file&quot;)
</a><a href="#h0-1-4" id="h0-1-4" class="i">+            ?: throw Exception(&quot;Failed to create script file&quot;)
</a> 
             context.androidContext.contentResolver.openOutputStream(scriptFile.uri, &quot;wt&quot;)?.use { output -&gt;
                 bufferedInputStream.copyTo(output)
<a href="#h0-2" id="h0-2" class="h">@@ -173,25 +173,29 @@ class RemoteScriptManager(
</a>                 val reader = inputStream.buffered().bufferedReader()
                 val moduleInfo = reader.readModuleInfo()
                 moduleInfo.takeIf {
<a href="#h0-2-3" id="h0-2-3" class="d">-                   it.version != inputModuleInfo.version
</a><a href="#h0-2-4" id="h0-2-4" class="i">+                    it.version != inputModuleInfo.version
</a>                 }
             }
<a href="#h0-2-7" id="h0-2-7" class="d">-       }.onFailure {
</a><a href="#h0-2-8" id="h0-2-8" class="d">-           context.log.error(&quot;Failed to check for updates&quot;, it)
</a><a href="#h0-2-9" id="h0-2-9" class="d">-       }.getOrNull()
</a><a href="#h0-2-10" id="h0-2-10" class="i">+        }.onFailure {
</a><a href="#h0-2-11" id="h0-2-11" class="i">+            context.log.error(&quot;Failed to check for updates&quot;, it)
</a><a href="#h0-2-12" id="h0-2-12" class="i">+        }.getOrNull()
</a>     }
 
<a href="#h0-2-15" id="h0-2-15" class="d">-
</a><a href="#h0-2-16" id="h0-2-16" class="d">-    override fun getEnabledScripts(): List&lt;String&gt; {
</a><a href="#h0-2-17" id="h0-2-17" class="i">+    private fun getEnabledScripts(sides: List&lt;String&gt;): List&lt;String&gt; {
</a>         return runCatching {
<a href="#h0-2-19" id="h0-2-19" class="d">-            getScriptFileNames().filter {
</a><a href="#h0-2-20" id="h0-2-20" class="d">-                context.database.isScriptEnabled(cachedModuleInfo[it]?.name ?: return@filter false)
</a><a href="#h0-2-21" id="h0-2-21" class="i">+            getScriptFileNames().filter { name -&gt;
</a><a href="#h0-2-22" id="h0-2-22" class="i">+                cachedModuleInfo[name]?.executionSides?.any { it in sides } ?: true &amp;&amp;
</a><a href="#h0-2-23" id="h0-2-23" class="i">+                        context.database.isScriptEnabled(cachedModuleInfo[name]?.name ?: return@filter false)
</a>             }
         }.onFailure {
             context.log.error(&quot;Failed to get enabled scripts&quot;, it)
         }.getOrDefault(emptyList())
     }
 
<a href="#h0-2-30" id="h0-2-30" class="i">+    override fun getEnabledScripts(): List&lt;String&gt; {
</a><a href="#h0-2-31" id="h0-2-31" class="i">+        return getEnabledScripts(listOf(BindingSide.CORE.key))
</a><a href="#h0-2-32" id="h0-2-32" class="i">+    }
</a><a href="#h0-2-33" id="h0-2-33" class="i">+
</a>     override fun getScriptContent(moduleName: String): ParcelFileDescriptor? {
         return getScriptInputStream(moduleName) { it?.toParcelFileDescriptor(context.coroutineScope) }
     }
<b>diff --git a/<a id="h1" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/util/ActivityLauncherHelper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/ActivityLauncherHelper.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/util/ActivityLauncherHelper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/ActivityLauncherHelper.kt</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -55,7 +55,6 @@ fun ActivityLauncherHelper.chooseFolder(callback: (uri: String) -&gt; Unit) {
</a>         Intent(Intent.ACTION_OPEN_DOCUMENT_TREE)
             .addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION)
             .addFlags(Intent.FLAG_GRANT_WRITE_URI_PERMISSION)
<a href="#h1-0-3" id="h1-0-3" class="d">-            .putExtra(&quot;android.provider.extra.SHOW_ADVANCED&quot;, true)
</a>     ) { resultCode, intent -&gt;
         if (resultCode != Activity.RESULT_OK) {
             return@launch
<b>diff --git a/<a id="h2" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/config/ModConfig.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/config/ModConfig.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/config/ModConfig.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/config/ModConfig.kt</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -34,41 +34,47 @@ class ModConfig(
</a>     private fun createRootConfig() = RootConfig().apply { lateInit(context) }
 
     fun load() {
<a href="#h2-0-3" id="h2-0-3" class="d">-        root = createRootConfig()
</a>         wasPresent = fileWrapper.exists()
<a href="#h2-0-5" id="h2-0-5" class="d">-        if (!wasPresent) {
</a><a href="#h2-0-6" id="h2-0-6" class="d">-            writeConfig()
</a><a href="#h2-0-7" id="h2-0-7" class="d">-            return
</a><a href="#h2-0-8" id="h2-0-8" class="d">-        }
</a><a href="#h2-0-9" id="h2-0-9" class="d">-
</a><a href="#h2-0-10" id="h2-0-10" class="d">-        runCatching {
</a><a href="#h2-0-11" id="h2-0-11" class="d">-            loadConfig()
</a><a href="#h2-0-12" id="h2-0-12" class="d">-        }.onFailure {
</a><a href="#h2-0-13" id="h2-0-13" class="d">-            writeConfig()
</a><a href="#h2-0-14" id="h2-0-14" class="i">+        root = createRootConfig().apply {
</a><a href="#h2-0-15" id="h2-0-15" class="i">+            if (!wasPresent) {
</a><a href="#h2-0-16" id="h2-0-16" class="i">+                writeConfigObject(this)
</a><a href="#h2-0-17" id="h2-0-17" class="i">+                return@apply
</a><a href="#h2-0-18" id="h2-0-18" class="i">+            }
</a><a href="#h2-0-19" id="h2-0-19" class="i">+            runCatching {
</a><a href="#h2-0-20" id="h2-0-20" class="i">+                loadConfig(this)
</a><a href="#h2-0-21" id="h2-0-21" class="i">+            }.onFailure {
</a><a href="#h2-0-22" id="h2-0-22" class="i">+                writeConfigObject(this)
</a><a href="#h2-0-23" id="h2-0-23" class="i">+            }
</a>         }
     }
 
<a href="#h2-0-27" id="h2-0-27" class="d">-    private fun loadConfig() {
</a><a href="#h2-0-28" id="h2-0-28" class="i">+    private fun loadConfig(config: RootConfig) {
</a>         val configFileContent = fileWrapper.readBytes()
         val configObject = gson.fromJson(configFileContent.toString(Charsets.UTF_8), JsonObject::class.java)
         locale = configObject.get(&quot;_locale&quot;)?.asString ?: LocaleWrapper.DEFAULT_LOCALE
<a href="#h2-0-32" id="h2-0-32" class="d">-        root.fromJson(configObject)
</a><a href="#h2-0-33" id="h2-0-33" class="i">+        config.fromJson(configObject)
</a>     }
 
     fun exportToString(
<a href="#h2-0-37" id="h2-0-37" class="d">-        exportSensitiveData: Boolean = true
</a><a href="#h2-0-38" id="h2-0-38" class="i">+        exportSensitiveData: Boolean = true,
</a><a href="#h2-0-39" id="h2-0-39" class="i">+        config: RootConfig = root,
</a>     ): String {
<a href="#h2-0-41" id="h2-0-41" class="d">-        val configObject = root.toJson(exportSensitiveData)
</a><a href="#h2-0-42" id="h2-0-42" class="d">-        configObject.addProperty(&quot;_locale&quot;, locale)
</a><a href="#h2-0-43" id="h2-0-43" class="d">-        return gson.toJson(configObject)
</a><a href="#h2-0-44" id="h2-0-44" class="i">+        return gson.toJson(config.toJson(exportSensitiveData).apply {
</a><a href="#h2-0-45" id="h2-0-45" class="i">+            addProperty(&quot;_locale&quot;, locale)
</a><a href="#h2-0-46" id="h2-0-46" class="i">+        })
</a>     }
 
     fun reset() {
<a href="#h2-0-50" id="h2-0-50" class="d">-        root = RootConfig()
</a><a href="#h2-0-51" id="h2-0-51" class="d">-        writeConfig()
</a><a href="#h2-0-52" id="h2-0-52" class="i">+        root = RootConfig().apply {
</a><a href="#h2-0-53" id="h2-0-53" class="i">+            writeConfigObject(this)
</a><a href="#h2-0-54" id="h2-0-54" class="i">+        }
</a>     }
 
     fun writeConfig() {
<a href="#h2-0-58" id="h2-0-58" class="i">+        writeConfigObject(root)
</a><a href="#h2-0-59" id="h2-0-59" class="i">+    }
</a><a href="#h2-0-60" id="h2-0-60" class="i">+
</a><a href="#h2-0-61" id="h2-0-61" class="i">+    private fun writeConfigObject(config: RootConfig) {
</a>         var shouldRestart = false
         var shouldCleanCache = false
         var configChanged = false
<a href="#h2-1" id="h2-1" class="h">@@ -105,13 +111,13 @@ class ModConfig(
</a>         }
 
         val oldConfig = runCatching { fileWrapper.readBytes().toString(Charsets.UTF_8) }.getOrNull()
<a href="#h2-1-3" id="h2-1-3" class="d">-        fileWrapper.writeBytes(exportToString().toByteArray(Charsets.UTF_8))
</a><a href="#h2-1-4" id="h2-1-4" class="i">+        fileWrapper.writeBytes(exportToString(config = config).toByteArray(Charsets.UTF_8))
</a> 
         configStateListener?.takeIf { it.asBinder().pingBinder() }?.also {
             runCatching {
                 compareDiff(createRootConfig().apply {
                     fromJson(gson.fromJson(oldConfig ?: return@runCatching, JsonObject::class.java))
<a href="#h2-1-10" id="h2-1-10" class="d">-                }, root)
</a><a href="#h2-1-11" id="h2-1-11" class="i">+                }, config)
</a> 
                 if (configChanged) {
                     it.onConfigChanged()
<b>diff --git a/<a id="h3" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/Experimental.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/Experimental.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/Experimental.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/Experimental.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -54,6 +54,7 @@ class Experimental : ConfigContainer() {
</a>     class AppLockConfig: ConfigContainer(hasGlobalState = true) {
         val lockOnResume = boolean(&quot;lock_on_resume&quot;, defaultValue = true)
     }
<a href="#h3-0-3" id="h3-0-3" class="i">+
</a>     val nativeHooks = container(&quot;native_hooks&quot;, NativeHooks()) { icon = Icons.Default.Memory; requireRestart() }
     val spoof = container(&quot;spoof&quot;, Spoof()) { icon = Icons.Default.Fingerprint ; addNotices(FeatureNotice.BAN_RISK); requireRestart() }
     val convertMessageLocally = boolean(&quot;convert_message_locally&quot;) { requireRestart() }
<b>diff --git a/<a id="h4" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/UserInterfaceTweaks.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/UserInterfaceTweaks.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/UserInterfaceTweaks.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/UserInterfaceTweaks.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -18,6 +18,7 @@ class UserInterfaceTweaks : ConfigContainer() {
</a>         val amount = integer(&quot;amount&quot;, defaultValue = 1)
     }
 
<a href="#h4-0-3" id="h4-0-3" class="i">+
</a>     val friendFeedMenuButtons = multiple(
         &quot;friend_feed_menu_buttons&quot;,&quot;conversation_info&quot;, &quot;mark_snaps_as_seen&quot;, &quot;mark_stories_as_seen_locally&quot;, *MessagingRuleType.entries.filter { it.showInFriendMenu }.map { it.key }.toTypedArray()
     ).apply {
<a href="#h4-1" id="h4-1" class="h">@@ -63,7 +64,7 @@ class UserInterfaceTweaks : ConfigContainer() {
</a>         &quot;lavender_field&quot;,
         &quot;lemon_drop&quot;,
         &quot;modern_farmhouse&quot;,
<a href="#h4-1-3" id="h4-1-3" class="d">-    )
</a><a href="#h4-1-4" id="h4-1-4" class="i">+    ) { addNotices(FeatureNotice.UNSTABLE); requireRestart() }
</a>     val friendFeedMessagePreview = container(&quot;friend_feed_message_preview&quot;, FriendFeedMessagePreview()) { requireRestart() }
     val snapPreview = boolean(&quot;snap_preview&quot;) { addNotices(FeatureNotice.UNSTABLE); requireRestart() }
     val bootstrapOverride = container(&quot;bootstrap_override&quot;, BootstrapOverride()) { requireRestart() }
<b>diff --git a/<a id="h5" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/type/ModuleInfo.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/type/ModuleInfo.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/type/ModuleInfo.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/type/ModuleInfo.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -12,6 +12,7 @@ data class ModuleInfo(
</a>     val minSnapchatVersion: Long? = null,
     val minSEVersion: Long? = null,
     val grantedPermissions: List&lt;String&gt;,
<a href="#h5-0-3" id="h5-0-3" class="i">+    val executionSides: List&lt;String&gt;? = null,
</a> ) {
     fun ensurePermissionGranted(permission: Permissions) {
         if (!grantedPermissions.contains(permission.key)) {
<a href="#h5-1" id="h5-1" class="h">@@ -53,5 +54,6 @@ fun BufferedReader.readModuleInfo(): ModuleInfo {
</a>         minSnapchatVersion = properties[&quot;minSnapchatVersion&quot;]?.toLongOrNull(),
         minSEVersion = properties[&quot;minSEVersion&quot;]?.toLongOrNull(),
         grantedPermissions = properties[&quot;permissions&quot;]?.split(&quot;,&quot;)?.map { it.trim() } ?: emptyList(),
<a href="#h5-1-3" id="h5-1-3" class="i">+        executionSides = properties[&quot;executionSides&quot;]?.lowercase()?.split(&quot;,&quot;)?.map { it.trim() },
</a>     )
 }
<b>diff --git a/<a id="h6" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/SnapEnhance.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/SnapEnhance.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/SnapEnhance.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/SnapEnhance.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -31,6 +31,7 @@ import me.rhunk.snapenhance.core.util.LSPatchUpdater
</a> import me.rhunk.snapenhance.core.util.hook.HookAdapter
 import me.rhunk.snapenhance.core.util.hook.HookStage
 import me.rhunk.snapenhance.core.util.hook.hook
<a href="#h6-0-3" id="h6-0-3" class="i">+import java.lang.reflect.Modifier
</a> import kotlin.reflect.KClass
 import kotlin.system.exitProcess
 import kotlin.system.measureTimeMillis
<a href="#h6-1" id="h6-1" class="h">@@ -124,8 +125,8 @@ class SnapEnhance {
</a> 
                 hookMainActivity(&quot;onResume&quot;) {
                     if (appContext.isMainActivityPaused.also {
<a href="#h6-1-3" id="h6-1-3" class="d">-                            appContext.isMainActivityPaused = false
</a><a href="#h6-1-4" id="h6-1-4" class="d">-                        }) {
</a><a href="#h6-1-5" id="h6-1-5" class="i">+                        appContext.isMainActivityPaused = false
</a><a href="#h6-1-6" id="h6-1-6" class="i">+                    }) {
</a>                         appContext.reloadConfig()
                         appContext.executeAsync {
                             syncRemote()
<a href="#h6-2" id="h6-2" class="h">@@ -360,7 +361,7 @@ class SnapEnhance {
</a>         fun strings(vararg classes: KClass&lt;*&gt;): Map&lt;Int, String&gt; {
             return classes.fold(mapOf()) { map, clazz -&gt;
                 map + clazz.java.fields.filter {
<a href="#h6-2-3" id="h6-2-3" class="d">-                    java.lang.reflect.Modifier.isStatic(it.modifiers) &amp;&amp; it.type == Int::class.javaPrimitiveType
</a><a href="#h6-2-4" id="h6-2-4" class="i">+                    Modifier.isStatic(it.modifiers) &amp;&amp; it.type == Int::class.javaPrimitiveType
</a>                 }.associate { it.getInt(null) to it.name }
             }
         }
<b>diff --git a/<a id="h7" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/XposedLoader.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/XposedLoader.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/XposedLoader.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/XposedLoader.kt</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -1,12 +1,22 @@
</a> package me.rhunk.snapenhance.core
 
<a href="#h7-0-2" id="h7-0-2" class="i">+import android.app.Application
</a> import de.robv.android.xposed.IXposedHookLoadPackage
<a href="#h7-0-4" id="h7-0-4" class="i">+import de.robv.android.xposed.XposedBridge
</a> import de.robv.android.xposed.callbacks.XC_LoadPackage
<a href="#h7-0-6" id="h7-0-6" class="i">+import me.rhunk.snapenhance.common.BuildConfig
</a> import me.rhunk.snapenhance.common.Constants
<a href="#h7-0-8" id="h7-0-8" class="i">+import me.rhunk.snapenhance.core.util.hook.HookStage
</a><a href="#h7-0-9" id="h7-0-9" class="i">+import me.rhunk.snapenhance.core.util.hook.hook
</a> 
 class XposedLoader : IXposedHookLoadPackage {
     override fun handleLoadPackage(p0: XC_LoadPackage.LoadPackageParam) {
         if (p0.packageName != Constants.SNAPCHAT_PACKAGE_NAME) return
<a href="#h7-0-14" id="h7-0-14" class="d">-        SnapEnhance()
</a><a href="#h7-0-15" id="h7-0-15" class="i">+        // prevent loading in sub-processes
</a><a href="#h7-0-16" id="h7-0-16" class="i">+        if (p0.processName.contains(&quot;:&quot;)) return
</a><a href="#h7-0-17" id="h7-0-17" class="i">+        XposedBridge.log(&quot;Loading SE Extended v${BuildConfig.VERSION_NAME}#${BuildConfig.GIT_HASH} (package: ${BuildConfig.APPLICATION_ID})&quot;)
</a><a href="#h7-0-18" id="h7-0-18" class="i">+        Application::class.java.hook(&quot;attach&quot;, HookStage.BEFORE) { param -&gt;
</a><a href="#h7-0-19" id="h7-0-19" class="i">+            SnapEnhance().init(param.arg(0))
</a><a href="#h7-0-20" id="h7-0-20" class="i">+        }
</a>     }
 } 
\ No newline at end of file
</pre>
</div>
</body>
</html>
